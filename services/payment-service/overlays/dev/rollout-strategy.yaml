apiVersion: argoproj.io/v1alpha1
kind: Rollout
metadata:
  name: payment-service
spec:
  strategy:
    canary:
      steps:
        # ğŸš€ Step 1: Immediate Update (Dev Speed)
        - setWeight: 100
        - pause: {duration: 15s}
        
        # ğŸ§ª Step 2: Run Functional Tests (Immediate Feedback)
        - analysis:
            templates:
              - templateName: synthetic-test-runner
            args:
              # ğŸŸ¢ Run the standard test suite
              - name: test-cmd
                value: "test:user" 
              # ğŸŸ¢ Target the deployed service directly
              - name: target-url
                value: "http://payment-service-canary"